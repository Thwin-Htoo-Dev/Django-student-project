<!DOCTYPE html>
<html>

<head>
    <title>
        {% if mode == "create" %}Add Student
        {% elif mode == "update" %}Update Student
        {% elif mode == "delete" %}Delete Student
        {% else %}Student Form
        {% endif %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #96ccf0;
            font-family: 'Segoe UI', sans-serif;
        }

        .form-container {
            background-color: #3cabb5;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 40px auto;
            animation: fadeIn 0.8s ease-in-out;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 900;
            font-size: 36px;
            color: #ffffff;
            animation: fadeInTitle 1s ease-out;
            text-shadow: 2px 2px 0 #333, 4px 4px 0 #222, 6px 6px 0 #111;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInTitle {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .g {
            background-color: red;
            color: white;
        }

        .btn-but {
            display: inline-block;
            padding: 5px 10px;
            color: rgb(14, 13, 13);
            background-color: #1dbad2;
            border: 2px solid black;
            border-radius: 10px;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
        }
    </style>
</head>

<body class="container py-5">
    <h2 class="mb-4">
        {% if mode == "create" %} Add Student
        {% elif mode == "update" %} Update Student
        {% elif mode == "detail" %} Student Detail
        {% elif mode == "delete" %} Delete Student
        {% endif %}
    </h2>

    <div class="form-container">
        <form method="post" novalidate id="student-delete-form">
            {% csrf_token %}
            {% if form.errors %}
            <div class="alert alert-danger text-center" role="alert">
                Please fill in all required fields correctly.
            </div>
            {% endif %}
            <div class="row g-3">
                <!-- Name -->
                <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        {{ form.name }}
                    </div>
                    {% if form.name.errors %}
                    <small class="text-danger">{{ form.name.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- Father Name -->
                <div class="col-md-6">
                    <label class="form-label">Father Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tie"></i></span>
                        {{ form.fathername }}
                    </div>
                    {% if form.fathername.errors %}
                    <small class="text-danger">{{ form.fathername.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- NRC -->
                <div class="col-md-6">
                    <label class="form-label">NRC</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                        {{ form.nrc }}
                    </div>
                    {% if form.nrc.errors %}
                    <small class="text-danger">{{ form.nrc.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- Email -->
                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                        {{ form.email }}
                    </div>
                    {% if form.email.errors %}
                    <small class="text-danger">{{ form.email.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- State -->
                <div class="col-md-6">
                    <label class="form-label">State</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                        {{ form.state }}
                    </div>
                    {% if form.state.errors %}
                    <small class="text-danger">{{ form.state.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- Address -->
                <div class="col-md-6">
                    <label class="form-label">Address</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-home"></i></span>
                        {{ form.address }}
                    </div>
                    {% if form.address.errors %}
                    <small class="text-danger">{{ form.address.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- DOB -->
                <div class="col-md-6">
                    <label class="form-label">Date of Birth</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                        {{ form.dob }}
                    </div>
                    {% if form.dob.errors %}
                    <div class="text-danger">{{ form.dob.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Phone -->
                <div class="col-md-6">
                    <label class="form-label">Phone</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-phone"></i></span>
                        {{ form.phone }}
                    </div>
                    {% if form.phone.errors %}
                    <small class="text-danger">{{ form.phone.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- Major -->
                <div class="col-md-6">
                    <label class="form-label">Major</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-book"></i></span>
                        {{ form.major }}
                    </div>
                    {% if form.major.errors %}
                    <small class="text-danger">{{ form.major.errors.0 }}</small>
                    {% endif %}
                </div>
            </div>
            <div class="mt-4 text-center">
                {% if mode == "create" %}
                <button type="submit" class="btn btn-info me-2">Create</button>
                {% elif mode == "update" %}
                <button type="submit" class="btn btn-info me-2">Update</button>
                {% elif mode == "delete" %}
                <!-- Trigger Modal -->
                <button type="button" class="btn btn-info me-2" data-bs-toggle="modal"
                    data-bs-target="#deleteConfirmModal">Delete</button>
                {% elif mode == "detail" %}
                <a href="{% url 'student_list' %}" class="btn btn-info me-2">Read</a>
                {% endif %}

                <!--{% if form.instance.pk %}
                <a href="{% url 'student_create' %}" class="btn btn-info me-2">Create New</a>
                {% if mode != "update" %}
                <a href="{% url 'student_update' pk=form.instance.pk %}" class="btn btn-info me-2">Update</a>
                {% endif %}
                {% if mode != "delete" %}
                <a href="{% url 'student_delete' pk=form.instance.pk %}" class="btn btn-info me-2">Delete</a>
                {% endif %}
                <a href="{% url 'student_detail' pk=form.instance.pk %}" class="btn btn-info me-2">Detail</a>
                {% else %}
                <button class="btn btn-secondary me-2" disabled>Update</button>
                <button class="btn btn-secondary me-2" disabled>Delete</button>
                <button class="btn btn-secondary me-2" disabled>Detail</button>
                {% endif %}-->

                <a href="{% url 'student_list' %}" class="btn btn-dark">Go Back to List</a>
            </div>
        </form>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color:#3cabb5;">
                <div class="modal-header">
                    <h5 class="modal-title w-100 text-center" id="deleteConfirmModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <p>Are you sure you want to delete this student?</p>
                    <p><strong>{{ form.instance.name }}</strong> (NRC: {{ form.instance.nrc }})</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="submit" class="btn btn-info" form="student-delete-form">Delete</button>
                    <button type="button" class="btn btn-but" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const phoneInput = document.querySelector('input[name="phone"]');
            const prefix = "+959";

            if (phoneInput) {
                // Set prefix if the input is empty or doesn't start with it
                if (!phoneInput.value.startsWith(prefix)) {
                    phoneInput.value = prefix;
                }

                // Prevent deleting or modifying the prefix
                phoneInput.addEventListener("keydown", function (e) {
                    const cursorPos = this.selectionStart;

                    if (cursorPos <= prefix.length && ["Backspace", "Delete"].includes(e.key)) {
                        e.preventDefault(); // Block deleting the prefix
                    }

                    // Allow control keys and digits only
                    const allowed = ["Backspace", "Delete", "ArrowLeft", "ArrowRight", "Tab"];
                    const isDigit = /^[0-9]$/.test(e.key);

                    if (cursorPos >= prefix.length && !isDigit && !allowed.includes(e.key)) {
                        e.preventDefault(); // Block non-digit keys
                    }
                });

                // Format input on each change
                phoneInput.addEventListener("input", function () {
                    if (!this.value.startsWith(prefix)) {
                        this.value = prefix;
                    }

                    // Keep only digits after prefix, limit to 9 digits
                    let digits = this.value.slice(prefix.length).replace(/\D/g, "").slice(0, 9);
                    this.value = prefix + digits;
                });

                // Handle paste
                phoneInput.addEventListener("paste", function (e) {
                    e.preventDefault();
                    const pasted = (e.clipboardData || window.clipboardData).getData("text");
                    const digits = pasted.replace(/\D/g, "").slice(0, 9);
                    this.value = prefix + digits;
                });
            }
            const nrcInput = document.querySelector('input[name="nrc"]');
            if (nrcInput) {
                nrcInput.setAttribute('autocomplete', 'off');
            }
        });
    </script>


</body>

</html>